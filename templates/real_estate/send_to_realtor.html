{% load static %}
<style>
  .realtor-section {
    background: linear-gradient(135deg, #f8f9fa, #e9f5ff);
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin: 40px 0;
    transition: transform .3s ease;
  }
  .realtor-section:hover {
    transform: translateY(-3px);
  }
  .realtor-avatar {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #0d6efd;
  }
  .btn-realtor {
    background: #0d6efd;
    color: #fff;
    border-radius: 30px;
    padding: 12px 28px;
    font-weight: 600;
    transition: 0.3s;
  }
  .btn-realtor:hover {
    background: #0b5ed7;
    color: #fff;
    transform: scale(1.05);
  }
</style>

<div class="realtor-section d-flex flex-column flex-md-row align-items-center justify-content-between">
  <div class="d-flex align-items-center gap-3 mb-3 mb-md-0">
    <img src="{% static 'img/realtor.jpg' %}" class="realtor-avatar" alt="Realtor">
    <div>
      <h4 class="fw-bold mb-1">üè° –í–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è —É—Å–ª—É–≥–∞–º–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∏—ç–ª—Ç–æ—Ä–∞</h4>
      <p class="text-muted mb-0">–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É –∏ –Ω–∞—à —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è</p>
    </div>
  </div>
  <button class="btn btn-realtor" data-bs-toggle="modal" data-bs-target="#realtorModal">
    ‚úçÔ∏è –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
  </button>
</div>

<!-- Modal —Ñ–æ—Ä–º–∞ -->
<div class="modal fade" id="realtorModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg rounded-4">
      <div class="modal-header border-0">
        <h5 class="modal-title">–ó–∞—è–≤–∫–∞ —Ä–∏—ç–ª—Ç–æ—Ä—É</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="realtorForm" method="post">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">–í–∞—à–µ –∏–º—è</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="tel" name="phone" class="form-control" required placeholder="+998 90 123 45 67">
          </div>
          <div class="mb-3">
            <label class="form-label">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
            <select name="property_type" class="form-select" required>
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
              <option value="–ö–≤–∞—Ä—Ç–∏—Ä–∞">–ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
              <option value="–î–æ–º">–î–æ–º</option>
              <option value="–£—á–∞—Å—Ç–æ–∫">–£—á–∞—Å—Ç–æ–∫</option>
              <option value="–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
            <textarea name="details" class="form-control" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="submit" class="btn btn-realtor w-100">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1055">
  <div id="toastRealtor" class="toast align-items-center text-white bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">‚úÖ –í–∞—à–∞ –∑–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ù–∞—à —Ä–∏—ç–ª—Ç–æ—Ä —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏.</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<script>
  document.getElementById("realtorForm").addEventListener("submit", function(e){
    e.preventDefault();
    const form = e.target;
    const fd = new FormData(form);

    fetch("{% url 'send_to_realtor' %}", {
      method: "POST",
      body: fd,
      headers: {"X-Requested-With": "XMLHttpRequest"}
    })
    .then(res => res.json())
    .then(data => {
      if (data.success){
        form.reset();
        bootstrap.Modal.getInstance(document.getElementById("realtorModal")).hide();
        new bootstrap.Toast(document.getElementById("toastRealtor")).show();
      } else {
        alert("–û—à–∏–±–∫–∞: " + (data.error || "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."));
      }
    })
    .catch(err => {
      console.error(err);
      alert("–°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞.");
    });
  });
</script>

