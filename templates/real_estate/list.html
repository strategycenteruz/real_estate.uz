{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% block content %}

<!-- Bootstrap Icons CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container py-4">
    <!-- –§–∏–ª—å—Ç—Ä —Ñ–æ—Ä–º–∞ -->
    {% include 'real_estate/filter_form.html' %}

    <!-- –ø–∞–Ω–µ–ª—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    {% include 'real_estate/category_bar.html' %}

    <!-- üìÑ –û–±—ä–µ–∫—Ç—ã -->
    {% if properties %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for item in properties %}
        <div class="col">
            <a class="text-decoration-none text-dark" href="{% url 'real_estate_detail' item.id %}">
                <div class="card h-100 shadow-sm border-0">
                    <div class="position-relative">

                        {% if item.images.first %}
                        <img alt="–§–æ—Ç–æ" class="card-img-top"
                             src="{{ item.images.first.image.url }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <img alt="–ù–µ—Ç —Ñ–æ—Ç–æ" class="card-img-top" src="{% static 'img/no-image.png' %}"
                             style="height: 200px;">
                        {% endif %}

                        {% if item.status == 'sold' %}
                        <span class="badge bg-danger position-absolute top-0 start-0 m-2">
                        <i class="bi bi-x-circle-fill"></i> –ü—Ä–æ–¥–∞–Ω–æ
                        </span>
                        {% elif item.status == 'active' %}
                        <span class="badge bg-warning text-dark position-absolute top-0 start-0 m-2">
                        <i class="bi bi-fire"></i> –°—Ä–æ—á–Ω–æ
                        </span>
                        {% endif %}

                        <!-- O'rtacha reyting -->
                        <div class="rating-display">
                            {% for i in "12345" %}
                                {% if forloop.counter <= item.average_rating|default:0 %}
                                    <i class="bi bi-star-fill text-warning"></i>
                                {% else %}
                                    <i class="bi bi-star text-secondary"></i>
                                {% endif %}
                            {% endfor %}
                            ({{ item.average_rating|floatformat:1|default:"0.0" }})
                        </div>

                    </div>

                    <div class="card-body">
                        <h5 class="card-title">{{ item.title|default:item.get_type_display }}</h5>
                        <p class="card-text text-muted mb-1">{{ item.address|truncatechars:40 }}</p>
                        <p class="card-text text-muted mb-1">{{ item.area }} –º¬≤</p>
                        <p class="card-text fs-5 text-success fw-bold">{{ item.price_usd|intcomma }} $</p>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>

    <!-- üìå Paginator -->
    {% if properties.has_other_pages %}
    <nav aria-label="Page navigation" class="mt-4">
        <ul class="pagination justify-content-center">

            {% if properties.has_previous %}
            <li class="page-item">
                <a class="page-link"
                   href="?page={{ properties.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                    –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                </a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</span></li>
            {% endif %}

            {% for num in properties.paginator.page_range %}
                {% if properties.number == num %}
                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                {% else %}
                    <li class="page-item">
                        <a class="page-link"
                           href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            {{ num }}
                        </a>
                    </li>
                {% endif %}
            {% endfor %}

            {% if properties.has_next %}
            <li class="page-item">
                <a class="page-link"
                   href="?page={{ properties.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                    –°–ª–µ–¥—É—é—â–∞—è
                </a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">–°–ª–µ–¥—É—é—â–∞—è</span></li>
            {% endif %}

        </ul>
    </nav>
    {% endif %}

    {% else %}
    <div class="alert alert-info">–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</div>
    {% endif %}


    <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è -->
    {% include 'real_estate/popular_list.html' %}

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –≤–∏–¥–µ–æ -->
    {% include 'real_estate/latest videos.html' %}

    <!-- O—Ü–µ–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ blok -->
    {% include "real_estate/estimate.html" %}

    <!-- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫ —Ä–∏–µ–ª—Ç–æ—Ä—É blok -->
    {% include "real_estate/send_to_realtor.html" %}

    <!-- –û—Ç–∑—ã–≤—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    {% include "real_estate/comments_slider.html" %}

</div>
{% endblock %}
