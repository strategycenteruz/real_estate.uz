{% load static %}
{% load humanize %}

<div class="container mt-5">
    <h5 class="mb-4">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h5>

    <!-- Swiper slider container -->
    <div class="swiper popularSwiper">
        <div class="swiper-wrapper">
            {% for item in popular_listings %}
            <div class="swiper-slide">
                <div class="card h-100 border-0 shadow-sm hover-shadow position-relative">

                    {% if item.images.first %}
                    <a href="{% url 'real_estate_detail' item.id %}">
                        <img class="card-img-top" src="{{ item.images.first.image.url }}"
                             style="height:200px; object-fit:cover; border-radius:12px 12px 0 0;">
                    </a>
                    {% else %}
                    <img class="card-img-top" src="{% static 'img/no-image.png' %}"
                         style="height:200px; object-fit:cover; border-radius:12px 12px 0 0;">
                    {% endif %}

                    <!-- ‚≠ê Favorite tugma -->
                    <a class="position-absolute top-0 end-0 m-2 p-2 rounded-circle shadow
                        {% if request.user.is_authenticated and item in request.user.favorite_ads.all %}
                           bg-warning text-white
                        {% else %}
                           bg-light text-secondary
                        {% endif %}"
                       href="{% url 'toggle_favorite' item.pk %}"
                       style="z-index: 10;">
                        {% if request.user.is_authenticated and item in request.user.favorite_ads.all %}
                        <i class="bi bi-star-fill fs-5"></i>
                        {% else %}
                        <i class="bi bi-star fs-5"></i>
                        {% endif %}
                    </a>

                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title mb-1">{{ item.title|truncatechars:25 }}</h6>
                        <p class="card-text mb-1"><strong>–ü–ª–æ—â–∞–¥—å:</strong> {{ item.area }} –º¬≤</p>
                        <p class="card-text mb-1"><strong>–¶–µ–Ω–∞:</strong> {{ item.price_usd|floatformat:0|intcomma }} $
                        </p>
                        <a class="btn btn-outline-primary btn-sm mt-auto" href="{% url 'real_estate_detail' item.id %}">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Slider navigation -->
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
    </div>
</div>

<!-- Swiper CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      var swiper = new Swiper(".popularSwiper", {
        loop: true,
        slidesPerView: 4,
        spaceBetween: 20,
        autoplay: {
          delay: 4000,
          disableOnInteraction: false,
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        breakpoints: {
          0: { slidesPerView: 1 },   // telefon
          768: { slidesPerView: 2 }, // planshet
          992: { slidesPerView: 3 }, // kichik laptop
          1200: { slidesPerView: 4 } // katta ekran
        }
      });
    });
</script>
