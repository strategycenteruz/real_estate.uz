{% extends 'base_detail.html' %}
{% block title %}–í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è{% endblock %}
{% load humanize %}

{% block content %}
<h3 class="mb-4">üìã –í—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h3>

<div class="table-responsive">
  <table id="realEstateTable" class="table table-hover align-middle text-center">
    <thead class="table-dark">
      <tr>
        <th>‚Ññ</th>
        <th>–§–æ—Ç–æ</th>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ü–ª–æ—â–∞–¥—å</th>
        <th>–ö–æ–º–Ω–∞—Ç</th>
        <th>–°—Ç–∞—Ç—É—Å</th>
        <th>–¶–µ–Ω–∞</th>
        <th>–î–∞—Ç–∞</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for realestate in realestates %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>
          {% if realestate.images.first %}
          <img src="{{ realestate.images.first.image.url }}"
               class="img-thumbnail shadow-sm realestate-img"
               style="height: 60px; width: 80px; object-fit: cover; cursor:pointer;"
               data-bs-toggle="modal" data-bs-target="#imgModal{{ realestate.id }}">
          <!-- Modal -->
          <div class="modal fade" id="imgModal{{ realestate.id }}" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
              <div class="modal-content">
                <div class="modal-body text-center">
                  <img src="{{ realestate.images.first.image.url }}" class="img-fluid rounded">
                </div>
              </div>
            </div>
          </div>
          {% endif %}
        </td>
        <td class="fw-semibold">{{ realestate.title }}</td>
        <td>{{ realestate.area }}</td>
        <td>{{ realestate.rooms }}</td>
        <td>
          <span class="badge {% if realestate.status == 'active' %}bg-danger{% else %}bg-secondary{% endif %}">
            {% if realestate.status == 'active' %}–°—Ä–æ—á–Ω–æ{% else %}–ü—Ä–æ–¥–∞–Ω–æ{% endif %}
          </span>
        </td>
        <td class="text-success fw-bold">{{ realestate.price_usd|floatformat:0|intcomma }} $</td>
        <td>{{ realestate.created_at|date:"d.m.Y" }}</td>
        <td>
          <a href="{% url 'real_estate_update' realestate.pk %}"
             class="btn btn-sm btn-outline-primary me-1" data-bs-toggle="tooltip" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
          <a href="{% url 'real_estate_delete' realestate.pk %}"
             class="btn btn-sm btn-outline-danger" data-bs-toggle="tooltip" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8" class="text-center text-muted">–û–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ—Ç.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- DataTables JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/dataTables.bootstrap5.min.js"></script>

<script>
  $(document).ready(function() {
    $('#realEstateTable').DataTable({
      "language": {
        "search": "üîç –ü–æ–∏—Å–∫:",
        "lengthMenu": "–ü–æ–∫–∞–∑–∞—Ç—å _MENU_ –∑–∞–ø–∏—Å–µ–π",
        "zeroRecords": "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
        "info": "–ü–æ–∫–∞–∑–∞–Ω–æ _START_‚Äì_END_ –∏–∑ _TOTAL_",
        "infoEmpty": "–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π",
        "paginate": {
          "first": "¬´",
          "last": "¬ª",
          "next": "‚Ä∫",
          "previous": "‚Äπ"
        }
      },
      "pageLength": 5,
      "lengthMenu": [5, 10, 25, 50]
    });

    // Tooltip init
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    });
  });
</script>
{% endblock %}
